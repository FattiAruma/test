<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æˆ‘çš„å°ç©ºé—´</title>

    <link rel="stylesheet" href="style.css">
    <!-- å¼•å…¥ Vue -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- å¼•å…¥ localforage (ç”¨äºå¤§å®¹é‡å­˜å‚¨) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
</head>
<body>
    
    <div id="app">
        <!-- å£çº¸ -->
        <div id="wallpaper-layer" :style="{ backgroundImage: 'url(' + wallpaper + ')' }"></div>

        <!-- æ¡Œé¢å¸ƒå±€ -->
        <div class="screens-wrapper">
            <div class="screens-container" :style="screensContainerStyle">
                <div class="screen">
                    <!-- æ¡Œé¢é¡¶éƒ¨ -->
                    <div class="widget-area">
                        <div class="avatar" :class="avatar.frame" :style="avatar.img ? { backgroundImage: 'url(' + avatar.img + ')' } : {}" @click="activeModal = 'image'; uploadTargetType = 'avatar'">
                            <span v-if="!avatar.img">ğŸ€</span>
                        </div>
                        <div class="user-name" :style="{ color: colors.header }" @click="openSingleEdit('name', 'åå­—')">{{ profile.name }}</div>
                        <div class="user-bio" :style="{ color: colors.header }" @click="openSingleEdit('bio1', 'ç¬¬ä¸€è¡Œç®€ä»‹')">{{ profile.bio1 }}</div>
                        <div class="user-bio" style="margin-top: 2px;" :style="{ color: colors.header }" @click="openSingleEdit('bio2', 'ç¬¬äºŒè¡Œç®€ä»‹')">{{ profile.bio2 }}</div>
                    </div>
                    <div class="layout-container">
                        <div class="photo-widget photo-1" :style="{ backgroundImage: 'url(' + photos[0] + ')' }" @click="activeModal = 'image'; uploadTargetType = 'photo'; uploadTargetIndex = 0"></div>
                        
                        <div class="app-item" v-for="(app, key) in desktopApps" :key="key" @click="handleAppClick(key)">
                            <div class="app-icon" :style="[app.img ? { backgroundImage: 'url(' + app.img + ')' } : {}, { color: colors.app }]"><span v-if="!app.img">{{ app.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ app.name }}</span>
                        </div>
            
                        <div class="glass-box text-widget" @click="openTextEdit(0)" :style="{ alignItems: getFlexAlign(textWidgets[0].align), textAlign: textWidgets[0].align }">
                            <div class="text-title" :style="{ color: colors.widget }">{{ textWidgets[0].title }}</div>
                            <div class="text-desc" :style="{ color: colors.widget }">{{ textWidgets[0].desc }}</div>
                        </div>
                        
                        <div class="photo-widget photo-2" style="grid-row: 3 / span 2; grid-column: 3 / span 2;" :style="{ backgroundImage: 'url(' + photos[1] + ')' }" @click="activeModal = 'image'; uploadTargetType = 'photo'; uploadTargetIndex = 1"></div>
                        
                        <div class="glass-box text-widget" @click="openTextEdit(1)" :style="{ alignItems: getFlexAlign(textWidgets[1].align), textAlign: textWidgets[1].align }">
                            <div class="text-title" :style="{ color: colors.widget }">{{ textWidgets[1].title }}</div>
                            <div class="text-desc" :style="{ color: colors.widget }">{{ textWidgets[1].desc }}</div>
                        </div>
                    </div>
                </div>
                <div class="screen">
                    <div class="layout-container">
                        <!-- ç¬¬äºŒé¡µå†…å®¹ -->
                        <div class="glass-box" style="grid-column: 1 / span 2; grid-row: 1 / span 2;"></div>

                        <div class="app-item" style="grid-column: 3; grid-row: 1;" @click="handleAppClick('taobao')">
                            <div class="app-icon" :style="[desktopAppsPage2.taobao.img ? { backgroundImage: 'url(' + desktopAppsPage2.taobao.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.taobao.img">{{ desktopAppsPage2.taobao.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.taobao.name }}</span>
                        </div>
                        <div class="app-item" style="grid-column: 4; grid-row: 1;" @click="handleAppClick('bilibili')">
                            <div class="app-icon" :style="[desktopAppsPage2.bilibili.img ? { backgroundImage: 'url(' + desktopAppsPage2.bilibili.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.bilibili.img">{{ desktopAppsPage2.bilibili.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.bilibili.name }}</span>
                        </div>
                        <div class="app-item" style="grid-column: 3; grid-row: 2;" @click="handleAppClick('ins')">
                            <div class="app-icon" :style="[desktopAppsPage2.ins.img ? { backgroundImage: 'url(' + desktopAppsPage2.ins.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.ins.img">{{ desktopAppsPage2.ins.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.ins.name }}</span>
                        </div>
                        <div class="app-item" style="grid-column: 4; grid-row: 2;" @click="handleAppClick('musicgame')">
                            <div class="app-icon" :style="[desktopAppsPage2.musicgame.img ? { backgroundImage: 'url(' + desktopAppsPage2.musicgame.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.musicgame.img">{{ desktopAppsPage2.musicgame.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.musicgame.name }}</span>
                        </div>

                        <div class="glass-box" style="grid-column: 1 / span 4; grid-row: 3 / span 2; min-height: 167px; margin: 12px 0;"></div>

                        <div class="app-item" style="grid-column: 1; grid-row: 5;" @click="handleAppClick('mailbox')">
                            <div class="app-icon" :style="[desktopAppsPage2.mailbox.img ? { backgroundImage: 'url(' + desktopAppsPage2.mailbox.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.mailbox.img">{{ desktopAppsPage2.mailbox.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.mailbox.name }}</span>
                        </div>
                        <div class="app-item" style="grid-column: 2; grid-row: 5;" @click="handleAppClick('discord')">
                            <div class="app-icon" :style="[desktopAppsPage2.discord.img ? { backgroundImage: 'url(' + desktopAppsPage2.discord.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.discord.img">{{ desktopAppsPage2.discord.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.discord.name }}</span>
                        </div>
                        <div class="app-item" style="grid-column: 1; grid-row: 6;" @click="handleAppClick('live')">
                            <div class="app-icon" :style="[desktopAppsPage2.live.img ? { backgroundImage: 'url(' + desktopAppsPage2.live.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.live.img">{{ desktopAppsPage2.live.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.live.name }}</span>
                        </div>
                        <div class="app-item" style="grid-column: 2; grid-row: 6;" @click="handleAppClick('novel')">
                            <div class="app-icon" :style="[desktopAppsPage2.novel.img ? { backgroundImage: 'url(' + desktopAppsPage2.novel.img + ')' } : {}, { color: colors.app }]"><span v-if="!desktopAppsPage2.novel.img">{{ desktopAppsPage2.novel.icon }}</span></div>
                            <span class="app-name" :style="{ color: colors.app }">{{ desktopAppsPage2.novel.name }}</span>
                        </div>

                        <div class="glass-box" style="grid-column: 3 / span 2; grid-row: 5 / span 2;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡µé¢æŒ‡ç¤ºå™¨ -->
        <div class="pagination-dots">
            <span class="dot" :class="{ active: currentPage === 0 }" @click="currentPage = 0"></span>
            <span class="dot" :class="{ active: currentPage === 1 }" @click="currentPage = 1"></span>
        </div>

        <!-- åº•éƒ¨ Dock -->
        <div class="dock-wrapper">
            <div class="dock">
                <div class="app-item" v-for="(app, key) in dockApps" :key="key" @click="handleAppClick(key)">
                    <div class="app-icon" :style="[app.img ? { backgroundImage: 'url(' + app.img + ')' } : {}, { color: colors.app }]"><span v-if="!app.img">{{ app.icon }}</span></div>
                    <span class="app-name" :style="{ color: colors.app }">{{ app.name }}</span>
                </div>
            </div>
        </div>

        <!-- === å­åº”ç”¨ç»„ä»¶ === -->
        <q-q-apps 
            :is-open="isQQOpen" 
            :api-config="apiConfig" 
            :qq-data="qqData"
            @close="isQQOpen = false">
        </q-q-apps>

        <settings-app 
            :is-open="isSettingsOpen" 
            :api-config="apiConfig" 
            v-model:model-list="modelList"
            :saved-apis="savedApis"
            @close="isSettingsOpen = false">
        </settings-app>

        <theme-apps 
            :is-open="isBeautifyOpen"
            :state="themeState" 
            @trigger-upload="handleThemeUpload"
            @reset="resetBeautify"
            @close="isBeautifyOpen = false">
        </theme-apps>

        <typeface-app 
            :is-open="isFontOpen"
            @close="isFontOpen = false">
        </typeface-app>

        <otomegame-app 
            :is-open="isOtomegameOpen"
            :qq-data="qqData"
            :api-config="apiConfig"
            @close="isOtomegameOpen = false">
        </otomegame-app>

        <worldbook-app 
            :is-open="isWorldbookOpen"
            @close="isWorldbookOpen = false">
        </worldbook-app>

        <savedata-app 
            :is-open="isSavedataOpen"
            @close="isSavedataOpen = false">
        </savedata-app>

        <!-- === å¼¹çª— === -->
        <div class="modal-overlay" v-if="activeModal === 'singleEdit'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">ç¼–è¾‘ {{ editTargetLabel }}</div>
                <input type="text" class="modal-input" v-model="tempInputVal">
                <button class="modal-btn" style="color: #34c759;" @click="saveSingleEdit">âœ… ä¿å­˜</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>
        
        <!-- å›¾ç‰‡/å¤´åƒé€šç”¨å¼¹çª— (å·²ä¿®æ”¹ï¼šç§»é™¤æœ¬åœ°ä¸Šä¼ ) -->
        <div class="modal-overlay" v-if="activeModal === 'image'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">æ›´æ¢å›¾ç‰‡</div>
                <button class="modal-btn" @click="handleLinkUpload(uploadTargetType, uploadTargetIndex)">ğŸ”— è¾“å…¥å›¾ç‰‡é“¾æ¥</button>
                <button class="modal-btn" v-if="uploadTargetType === 'avatar'" @click="activeModal = 'frame'" style="color: #ff6b81;">ğŸ–¼ï¸ æ›´æ¢å¤´åƒæ¡†</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>
        
        <div class="modal-overlay" v-if="activeModal === 'frame'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">é€‰æ‹©å¤´åƒæ¡†</div>
                <div class="frame-grid">
                    <div class="frame-option-container" @click="setFrame('')"><div class="frame-preview frame-none"></div><div class="frame-label">æ— </div></div>
                    <div class="frame-option-container" @click="addCustomFrame"><div class="frame-preview frame-add">+</div><div class="frame-label">è‡ªå®šä¹‰</div></div>
                    <div class="frame-option-container" @click="setFrame('frame-pink')"><div class="frame-preview frame-pink"></div><div class="frame-label">ç®€çº¦ç²‰</div></div>
                    <div class="frame-option-container" @click="setFrame('frame-gradient')"><div class="frame-preview frame-gradient"></div><div class="frame-label">æ¢¦å¹»ç´«</div></div>
                    <div class="frame-option-container" @click="setFrame('frame-stitch')"><div class="frame-preview frame-stitch"></div><div class="frame-label">ç¼çº«é£</div></div>
                    <div class="frame-option-container" @click="setFrame('frame-gold')"><div class="frame-preview frame-gold"></div><div class="frame-label">æµå…‰é‡‘</div></div>
                    <!-- é¢„è®¾å¤´åƒæ¡† -->
                    <div class="frame-option-container" v-for="(frameUrl, index) in presetFrames" :key="'preset-' + index" @click="setFrame('preset-frame-' + index)">
                        <div class="frame-preview" :class="'preset-frame-' + index" :style="{ backgroundImage: 'url(' + frameUrl + ')', backgroundSize: 'cover', backgroundPosition: 'center' }"></div>
                        <div class="frame-label">é¢„è®¾{{ index + 1 }}</div>
                    </div>
                    <!-- è‡ªå®šä¹‰å¤´åƒæ¡† -->
                    <div class="frame-option-container" v-for="(frameUrl, index) in customFrames" :key="'custom-' + index">
                        <div class="frame-preview" :class="'custom-frame-' + index" :style="{ backgroundImage: 'url(' + frameUrl + ')', backgroundSize: 'cover', backgroundPosition: 'center' }" @click="setFrame('custom-frame-' + index)"></div>
                        <div class="frame-label">è‡ªå®šä¹‰{{ index + 1 }}</div>
                        <button class="delete-frame-btn" @click.stop="deleteCustomFrame(index)" title="åˆ é™¤æ­¤å¤´åƒæ¡†">Ã—</button>
                    </div>
                </div>
                <button class="modal-btn cancel" @click="activeModal = null">è¿”å›</button>
            </div>
        </div>

        <!-- å£çº¸å¼¹çª— (å·²ä¿®æ”¹ï¼šç§»é™¤æœ¬åœ°ä¸Šä¼ ) -->
        <div class="modal-overlay" v-if="activeModal === 'wallpaper'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">æ›´æ¢å£çº¸</div>
                <button class="modal-btn" @click="handleLinkUpload('wallpaper')">ğŸ”— è¾“å…¥å£çº¸é“¾æ¥</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>

        <div class="modal-overlay" v-if="activeModal === 'textEdit'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">ç¼–è¾‘æ–‡å­—ç»„ä»¶</div>
                <div class="text-input-group">
                    <input type="text" class="modal-input" v-model="tempText.title" placeholder="æ ‡é¢˜">
                    <input type="text" class="modal-input" v-model="tempText.desc" placeholder="å†…å®¹">
                </div>
                <div class="align-control">
                    <button class="align-btn" :class="{ active: tempText.align === 'left' }" @click="tempText.align = 'left'">â¬…ï¸ å·¦</button>
                    <button class="align-btn" :class="{ active: tempText.align === 'center' }" @click="tempText.align = 'center'">â¬‡ï¸ ä¸­</button>
                    <button class="align-btn" :class="{ active: tempText.align === 'right' }" @click="tempText.align = 'right'">â¡ï¸ å³</button>
                </div>
                <button class="modal-btn" style="color: #34c759;" @click="saveTextEdit">âœ… ä¿å­˜ä¿®æ”¹</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>
        
        <!-- å›¾æ ‡å¼¹çª— (å·²ä¿®æ”¹ï¼šç§»é™¤æœ¬åœ°ä¸Šä¼ ) -->
        <div class="modal-overlay" v-if="activeModal === 'icon'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">æ›´æ¢å›¾æ ‡</div>
                <button class="modal-btn" @click="handleLinkUpload('icon', uploadTargetIndex)">ğŸ”— è¾“å…¥å›¾ç‰‡é“¾æ¥</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>
        
        <!-- ç§»é™¤äº†åŸæœ¬åœ¨è¿™é‡Œçš„ <input type="file"> -->
    </div>

    <!-- å¼•å…¥ main.jsï¼Œæ³¨æ„ type="module" -->
    <script type="module" src="main.js"></script>
</body>
</html>
