<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æˆ‘çš„å°ç©ºé—´</title>
    <link rel="stylesheet" href="style.css">
    <!-- ...åé¢æ˜¯ä½ åŸæœ¬çš„è„šæœ¬ä»£ç ... -->
    <!-- é”™è¯¯æ•è·è„šæœ¬ -->
    <script>
        window.addEventListener('error', function(e) {
            alert('âŒ å‘ç”Ÿé”™è¯¯:\n' + e.message + '\n\nå¦‚æœæ˜¯ "Failed to resolve module"ï¼Œè¯·æ£€æŸ¥ apps æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶åæ˜¯å¦å¤§å°å†™æ­£ç¡®ï¼');
        });
    </script>
</head>
<body>
    
    <!-- v-cloak æ”¾åœ¨è¿™é‡Œ -->
    <div id="app" v-cloak>
        <div id="wallpaper-layer" :style="{ backgroundImage: 'url(' + wallpaper + ')' }"></div>

        <div class="widget-area">
            <div class="avatar" :class="avatar.frame" :style="avatar.img ? { backgroundImage: 'url(' + avatar.img + ')' } : {}" @click="activeModal = 'image'; uploadTargetType = 'avatar'">
                <span v-if="!avatar.img">ğŸ€</span>
            </div>
            <div class="user-name" :style="{ color: colors.header }" @click="openSingleEdit('name', 'åå­—')">{{ profile.name }}</div>
            <div class="user-bio" :style="{ color: colors.header }" @click="openSingleEdit('bio1', 'ç¬¬ä¸€è¡Œç®€ä»‹')">{{ profile.bio1 }}</div>
            <div class="user-bio" style="margin-top: 2px;" :style="{ color: colors.header }" @click="openSingleEdit('bio2', 'ç¬¬äºŒè¡Œç®€ä»‹')">{{ profile.bio2 }}</div>
        </div>

        <div class="layout-container">
            <div class="photo-widget photo-1" :style="{ backgroundImage: 'url(' + photos[0] + ')' }" @click="activeModal = 'image'; uploadTargetType = 'photo'; uploadTargetIndex = 0"></div>
            
            <div class="app-item" v-for="(app, key) in desktopApps" :key="key" @click="handleAppClick(key)">
                <div class="app-icon" :style="[app.img ? { backgroundImage: 'url(' + app.img + ')' } : {}, { color: colors.app }]"><span v-if="!app.img">{{ app.icon }}</span></div>
                <span class="app-name" :style="{ color: colors.app }">{{ app.name }}</span>
            </div>

            <div class="glass-box text-widget" @click="openTextEdit(0)" :style="{ alignItems: getFlexAlign(textWidgets[0].align), textAlign: textWidgets[0].align }">
                <div class="text-title" :style="{ color: colors.widget }">{{ textWidgets[0].title }}</div>
                <div class="text-desc" :style="{ color: colors.widget }">{{ textWidgets[0].desc }}</div>
            </div>
            
            <div class="photo-widget photo-2" style="grid-row: 3 / span 2; grid-column: 3 / span 2;" :style="{ backgroundImage: 'url(' + photos[1] + ')' }" @click="activeModal = 'image'; uploadTargetType = 'photo'; uploadTargetIndex = 1"></div>
            
            <div class="glass-box text-widget" @click="openTextEdit(1)" :style="{ alignItems: getFlexAlign(textWidgets[1].align), textAlign: textWidgets[1].align }">
                <div class="text-title" :style="{ color: colors.widget }">{{ textWidgets[1].title }}</div>
                <div class="text-desc" :style="{ color: colors.widget }">{{ textWidgets[1].desc }}</div>
            </div>
        </div>

        <div class="dock-wrapper">
            <div class="dock">
                <div class="app-item" v-for="(app, key) in dockApps" :key="key" @click="handleAppClick(key)">
                    <div class="app-icon" :style="[app.img ? { backgroundImage: 'url(' + app.img + ')' } : {}, { color: colors.app }]"><span v-if="!app.img">{{ app.icon }}</span></div>
                    <span class="app-name" :style="{ color: colors.app }">{{ app.name }}</span>
                </div>
            </div>
        </div>

        <!-- å¼•å…¥å­ç»„ä»¶ -->
        <qq-apps 
            :is-open="isQQOpen" 
            :api-config="apiConfig" 
            :qq-data="qqData"
            @close="isQQOpen = false">
        </qq-apps>

        <settings-app 
            :is-open="isSettingsOpen" 
            :api-config="apiConfig" 
            v-model:model-list="modelList"
            :saved-apis="savedApis"
            @close="isSettingsOpen = false">
        </settings-app>

        <theme-apps 
            :is-open="isBeautifyOpen"
            :state="themeState" 
            @trigger-upload="handleThemeUpload"
            @reset="resetBeautify"
            @close="isBeautifyOpen = false">
        </theme-apps>

        <!-- å¼¹çª—éƒ¨åˆ† -->
        <div class="modal-overlay" v-if="activeModal === 'singleEdit'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">ç¼–è¾‘ {{ editTargetLabel }}</div>
                <input type="text" class="modal-input" v-model="tempInputVal">
                <button class="modal-btn" style="color: #34c759;" @click="saveSingleEdit">âœ… ä¿å­˜</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>
        
        <div class="modal-overlay" v-if="activeModal === 'image'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">ä¸ªæ€§åŒ–</div>
                <button class="modal-btn" @click="triggerFileUpload(uploadTargetType, uploadTargetIndex)">ğŸ“‚ æœ¬åœ°ä¸Šä¼  (ç›¸å†Œ)</button>
                <button class="modal-btn" @click="handleLinkUpload(uploadTargetType, uploadTargetIndex)">ğŸ”— é“¾æ¥ä¸Šä¼  (URL)</button>
                <button class="modal-btn" v-if="uploadTargetType === 'avatar'" @click="activeModal = 'frame'" style="color: #ff6b81;">ğŸ–¼ï¸ æ›´æ¢å¤´åƒæ¡†</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>
        
        <div class="modal-overlay" v-if="activeModal === 'frame'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">é€‰æ‹©å¤´åƒæ¡†</div>
                <div class="frame-grid">
                    <div class="frame-option-container" @click="setFrame('')"><div class="frame-preview frame-none"></div><div class="frame-label">æ— </div></div>
                    <div class="frame-option-container" @click="setFrame('frame-pink')"><div class="frame-preview frame-pink"></div><div class="frame-label">ç®€çº¦ç²‰</div></div>
                    <div class="frame-option-container" @click="setFrame('frame-gradient')"><div class="frame-preview frame-gradient"></div><div class="frame-label">æ¢¦å¹»ç´«</div></div>
                    <div class="frame-option-container" @click="setFrame('frame-stitch')"><div class="frame-preview frame-stitch"></div><div class="frame-label">ç¼çº«é£</div></div>
                    <div class="frame-option-container" @click="setFrame('frame-gold')"><div class="frame-preview frame-gold"></div><div class="frame-label">æµå…‰é‡‘</div></div>
                </div>
                <button class="modal-btn cancel" @click="activeModal = null">è¿”å›</button>
            </div>
        </div>

        <div class="modal-overlay" v-if="activeModal === 'wallpaper'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">é€‰æ‹©å£çº¸æ¥æº</div>
                <button class="modal-btn" @click="triggerFileUpload('wallpaper')">ğŸ“‚ æœ¬åœ°ä¸Šä¼  (ç›¸å†Œ)</button>
                <button class="modal-btn" @click="handleLinkUpload('wallpaper')">ğŸ”— é“¾æ¥ä¸Šä¼  (URL)</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>

        <div class="modal-overlay" v-if="activeModal === 'textEdit'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">ç¼–è¾‘æ–‡å­—ç»„ä»¶</div>
                <div class="text-input-group">
                    <input type="text" class="modal-input" v-model="tempText.title" placeholder="æ ‡é¢˜">
                    <input type="text" class="modal-input" v-model="tempText.desc" placeholder="å†…å®¹">
                </div>
                <div class="align-control">
                    <button class="align-btn" :class="{ active: tempText.align === 'left' }" @click="tempText.align = 'left'">â¬…ï¸ å·¦</button>
                    <button class="align-btn" :class="{ active: tempText.align === 'center' }" @click="tempText.align = 'center'">â¬‡ï¸ ä¸­</button>
                    <button class="align-btn" :class="{ active: tempText.align === 'right' }" @click="tempText.align = 'right'">â¡ï¸ å³</button>
                </div>
                <button class="modal-btn" style="color: #34c759;" @click="saveTextEdit">âœ… ä¿å­˜ä¿®æ”¹</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>
        
        <div class="modal-overlay" v-if="activeModal === 'icon'" @click.self="activeModal = null">
            <div class="modal-content">
                <div class="modal-title">æ›´æ¢å›¾æ ‡</div>
                <button class="modal-btn" @click="triggerFileUpload('icon', uploadTargetIndex)">ğŸ“‚ æœ¬åœ°ä¸Šä¼  (ç›¸å†Œ)</button>
                <button class="modal-btn" @click="handleLinkUpload('icon', uploadTargetIndex)">ğŸ”— é“¾æ¥ä¸Šä¼  (URL)</button>
                <button class="modal-btn cancel" @click="activeModal = null">å–æ¶ˆ</button>
            </div>
        </div>

        <input type="file" ref="fileInput" hidden accept="image/*" @change="handleFileChange">
    </div>

    <!-- å¼•ç”¨ main.js -->
    <script type="module" src="main.js"></script>
</body>
</html>
